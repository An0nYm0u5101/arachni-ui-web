<div class="row-fluid">
    <div class="span10">
        <div class="page-header">
            <h1><%= profile.name %></h1>
            <div class="lead"><%= profile.html_description %></div>
        </div>
    </div>

    <div class="span2">
        <% if profile.global? %>
            <p class="label label-info">
                Global
            </p>
        <% end %>

        <div class="visible-phone">
            <%= render partial: 'actions', locals: { profile: profile } %>
        </div>
    </div>
</div>

<section id="spider">
    <h2 id="spider-h">
        Spider
        <small>How the scanner will crawl the web application</small>
    </h2>

    <div class="row-fluid">
        <% if profile.scope_redundant_path_patterns.any? %>
        <div class="span6">
            <div>
                <b>Redundant:</b>
                <table class="table table-hover">
                    <tr>
                        <th>Paths matching</th>
                        <th>will be followed this amount of times</th>
                    </tr>
                <% profile.scope_redundant_path_patterns.each do |pattern, counter| %>
                    <tr>
                        <td>
                            <%= pattern %>
                        </td>
                        <td>
                            <%= counter %>
                        </td>
                    </tr>
                <% end %>

                </table>
            </div>
            <%= messages_for :scope_redundant_path_patterns %>
        </div>
        <% end %>

        <% if profile.scope_auto_redundant %>
        <div class="span6">
            <p>
                <b>Auto redundant:</b>
                <%= profile.scope_auto_redundant %>
            </p>
            <%= messages_for :scope_auto_redundant %>
        </div>
        <% end %>
    </div>

    <div class="row-fluid">
        <% if profile.scope_directory_depth_limit %>
        <div class="span6">
            <p>
                <b>Depth limit:</b>
                <%= profile.scope_directory_depth_limit %>
            </p>
            <%= messages_for :scope_directory_depth_limit %>
        </div>
        <% end %>

        <% if profile.scope_page_limit %>
        <div class="span6">
            <p>
                <b>Link count limit:</b>
                <%= profile.scope_page_limit %>
            </p>
            <%= messages_for :scope_page_limit %>
        </div>
        <% end %>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Redirect limit:</b>
                <%= profile.http_request_redirect_limit %>
            </p>
            <%= messages_for :http_request_redirect_limit %>
        </div>
        <div class="span6">
            <p>
                <b>Follow subdomains:</b>
                <input <%= 'checked' if profile.scope_include_subdomains %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :scope_include_subdomains %>
        </div>
    </div>
    <div class="row-fluid">
        <% if profile.scope_exclude_binaries %>
        <div class="span6">
            <p>
                <b>Exclude binaries:</b>
                <input <%= 'checked' if profile.scope_exclude_binaries %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :scope_exclude_binaries %>
        </div>
        <% end %>
        <% if profile.scope_https_only %>
            <div class="span6">
                <p>
                    <b>HTTPS only:</b>
                    <input <%= 'checked' if profile.scope_https_only %>
                           disabled type="checkbox">
                </p>
                <%= messages_for :scope_https_only %>
            </div>
        <% end %>

    </div>
    <div class="row-fluid">
        <% if profile.scope_exclude_path_patterns.any? %>
        <div class="span6">
            <p>
                <b>Exclude:</b>
                <textarea disabled
                          id="profile_exclude"><%= profile.scope_exclude_path_patterns.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :scope_exclude_path_patterns %>
        </div>
        <% end %>

        <% if profile.scope_include_path_patterns.any? %>
        <div class="span6">
            <p>
                <b>Include:</b>
                <textarea disabled
                          id="profile_include"><%= profile.scope_include_path_patterns.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :scope_include_path_patterns %>
        </div>
        <% end %>
    </div>
    <div class="row-fluid">
        <% if profile.scope_restrict_paths.any? %>
        <div class="span6">
            <p>
                <b>Restrict paths:</b> <br/>
                <textarea disabled
                          id="profile_restrict_paths"><%= profile.scope_restrict_paths.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :scope_restrict_paths %>
        </div>
        <% end %>

        <% if profile.scope_extend_paths.any? %>
        <div class="span6">
            <p>
                <b>Extend paths:</b>
                <textarea disabled
                          id="profile_extend_paths"><%= profile.scope_extend_paths.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :scope_extend_paths %>
        </div>
        <% end %>
    </div>
    <div class="row-fluid">
        <% if profile.scope_exclude_content_patterns.any? %>
            <div class="span6">
                <p>
                    <b>Exclude pages:</b> <br/>
                    <textarea disabled
                              id="profile_exclude_pages"><%= profile.scope_exclude_content_patterns.join( "\n" ) %></textarea>
                </p>
                <%= messages_for :scope_exclude_content_patterns %>
            </div>
        <% end %>
    </div>
</section>

<hr/>

<section id="http">
    <h2 id="http-h">
        HTTP
        <small>How the scanner will communicate with the web application</small>
    </h2>

    <% if !profile.http_authentication_username.to_s.empty? && !profile.http_authentication_password.to_s.empty? %>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>HTTP username:</b>
                <%= profile.http_authentication_username %>
            </p>
            <%= messages_for :http_authentication_username %>
        </div>
        <div class="span6">
            <p>
                <b>HTTP password:</b>
                <%= profile.http_authentication_password %>
            </p>
            <%= messages_for :http_authentication_password %>
        </div>
    </div>
    <%end%>

    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>HTTP request concurrency limit:</b>
                <%= profile.http_request_concurrency %>
            </p>
            <%= messages_for :http_request_concurrency %>
        </div>
        <div class="span6">
            <p>
                <b>HTTP request queue size:</b>
                <%= profile.http_request_queue_size %>
            </p>
            <%= messages_for :http_request_queue_size %>
        </div>
    </div>

    <% if !profile.http_proxy_host.to_s.empty? && profile.http_proxy_port %>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Proxy host:</b>
                <%= profile.http_proxy_host %>
            </p>
            <%= messages_for :http_proxy_host %>
        </div>
        <div class="span6">
            <p>
                <b>Proxy port:</b>
                <%= profile.http_proxy_port %>
            </p>
            <%= messages_for :http_proxy_port %>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Proxy username:</b>
                <%= profile.http_proxy_username %>
            </p>
            <%= messages_for :http_proxy_username %>
        </div>
        <div class="span6">
            <p>
                <b>Proxy password:</b>
                <%= profile.http_proxy_password %>
            </p>
            <%= messages_for :http_proxy_password %>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Proxy type:</b>
                <%= profile.http_proxy_type %>
            </p>
            <%= messages_for :http_proxy_type %>
        </div>
    </div>
    <% end %>

    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>User agent:</b>
                <%= profile.http_user_agent %>
            </p>
            <%= messages_for :http_user_agent %>
        </div>
        <div class="span6">
            <p>
                <b>Request timeout:</b>
                <%= profile.http_request_timeout %>
            </p>
            <%= messages_for :http_request_timeout %>
        </div>
    </div>
    <div class="row-fluid">
        <% if profile.http_cookies.any? %>
        <div class="span6">
            <p>
                <b>Cookies:</b>
                <textarea disabled
                          id="profile_cookies"><%= profile.http_cookies.map { |k, v| "#{k}=#{v}" }.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :http_cookies %>
        </div>
        <% end %>

        <% if profile.http_request_headers.any? %>
        <div class="span6">
            <p>
                <b>Custom headers:</b>
                <textarea disabled
                          id="profile_custom_headers"><%= profile.http_request_headers.map { |k, v| "#{k}=#{v}" }.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :http_request_headers %>
        </div>
        <% end %>
    </div>
</section>

<hr/>

<section id="auditor">
    <h2 id="auditor-h">
        Auditor
        <small>How the scanner will audit the web application</small>
    </h2>

    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Audit forms:</b>
                <input <%= 'checked' if profile.audit_forms %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :audit_forms %>
        </div>
        <div class="span6">
            <p>
                <b>Audit links:</b>
                <input <%= 'checked' if profile.audit_links %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :audit_links %>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <p>
                <b>Audit cookies:</b>
                <input <%= 'checked' if profile.audit_cookies %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :audit_cookies %>
        </div>
        <div class="span6">
            <p>
                <b>Audit headers:</b>
                <input <%= 'checked' if profile.audit_headers %>
                       disabled type="checkbox">
            </p>
            <%= messages_for :audit_headers %>
        </div>
    </div>
    <div class="row-fluid">
        <% if profile.audit_with_both_http_methods %>
            <div class="span6">
                <p>
                    <b>Fuzz methods:</b>
                    <input <%= 'checked' if profile.audit_with_both_http_methods %>
                           disabled type="checkbox">
                </p>
                <%= messages_for :audit_with_both_http_methods %>
            </div>
        <% end %>

        <% if profile.audit_cookies_extensively %>
            <div class="span6">
                <p>
                    <b>Audit cookies extensively:</b>
                    <input <%= 'checked' if profile.audit_cookies_extensively %>
                           disabled type="checkbox">
                </p>
                <%= messages_for :audit_cookies_extensively %>
            </div>
        <% end %>
    </div>

    <div class="row-fluid">
        <% if profile.audit_exclude_vectors.any? %>
        <div class="span6">
            <p>
                <b>Exclude vectors:</b>
                <textarea disabled
                          id="profile_exclude_vectors"><%= profile.audit_exclude_vectors.join( "\n" ) %></textarea>
            </p>
            <%= messages_for :audit_exclude_vectors %>
        </div>
        <% end %>
    </div>
</section>

<hr/>

<section id="fingerprinting">
    <fieldset>
        <legend id="fingerprinting-h">
            Platform fingerprinting
            <small>What platforms should the scanner anticipate</small>
        </legend>

        <div class="row-fluid">
            <div class="span6">
                <b>Disable fingerprinting:</b>
                <input <%= 'checked' if profile.no_fingerprinting %>
                       disabled type="checkbox">

            </div>
        </div>

        <h4>
            Platforms
            <small>Explicitly specify platforms to improve efficiency</small>
        </h4>


        <div class="row-fluid">
            <% [:os, :db, :servers, :languages, :frameworks].each_with_index do |type, i| %>

                <div class="span2">
                    <h5><%= platform_type_fullname( type ) %></h5>

                    <% valid_platforms( type ).each do |platform| %>
                        <p>
                            <%= platform_fullname( platform ) %>
                            <input <%= 'checked' if profile.platforms.include?( platform ) %>
                                   disabled type="checkbox">
                        </p>
                <% end %>
                </div>
            <% end %>
        </div>

    </fieldset>
</section>

<hr/>

<section id="modules">
    <h2 id="modules-h">
        Modules
        <small>The security checks to be run again the web application</small>
    </h2>

    <% if profile.checks.any? %>
    <h3>
        Audit (Active)
        <small>These checks will actively engage the web application via its inputs (links, forms, etc.)</small>
    </h3>

    <% audit = profile.checks_with_info.select { |n, i| i[:path].include?( '/checks/audit' ) } %>
    <% if audit.any? %>
    <%= render partial: '/shared/components_twin_accordion',
               locals: {
                   components: audit,
                   class_name: 'span6'
               } %>
    <% else %>
    <p class="alert alert-info">No audit modules have been selected.</p>
    <% end %>

    <h3>
        Recon (Passive)
        <small>These checks will passively collect data</small>
    </h3>

    <% recon = profile.checks_with_info.select { |n, i| i[:path].include?( '/checks/recon' ) } %>
    <% if recon.any? %>
    <%= render partial: '/shared/components_twin_accordion',
               locals: {
                   components: recon,
                   class_name: 'span6'
               } %>
    <% else %>
    <p class="alert alert-info">No recon modules have been selected.</p>
    <% end %>
    <% else %>
        <p class="alert alert-info">No modules have been selected.</p>
    <% end %>

</section>

<hr/>

<section id="plugins">
    <h2 id="plugins-h">
        Plugins
        <small>Assisting components to be enabled during the process</small>
    </h2>

    <% if profile.has_plugins? %>
    <%= render partial: '/shared/components_twin_accordion',
               locals: { components: profile.plugins_with_info, class_name: 'span6' }  %>
    <% else %>
    <p class="alert alert-info">No plugins have been selected.</p>
    <% end %>

</section>

<hr/>

<section id="login">
    <h2 id="login-h">
        Login check
        <small>How the scanner will determine its session's validity</small>
    </h2>

    <div class="row-fluid">

        <% if !profile.login_check_url.to_s.empty? && !profile.login_check_pattern.to_s.empty? %>
        <div class="span6">
            <p>
                <b>URL:</b>
                <%= profile.login_check_url %>
            </p>
            <%= messages_for :login_check_url %>
        </div>
        <div class="span6">
            <p>
                <b>Pattern:</b>
                <%= profile.login_check_pattern %>
            </p>
            <%= messages_for :login_check_pattern %>
        </div>
        <% else %>
            <div class="span12">
                <p class="alert alert-info">Not configured.</p>
            </div>
        <% end %>
    </div>
</section>
