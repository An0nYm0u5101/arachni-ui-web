<% issues = @scan.active? || @scan.error? ? @scan.sorted_issues : @scan.report.issues %>

<div class="row">
    <div class="span12" id='issues'>
        <h2>Issues <small>[<%= issues.size %>]</small></h2>

        <p class="muted">Click on an issue's name for more information.</p>

        <% if issues.any? %>
            <table class="hidden-phone table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>URL</th>
                        <th>Element</th>
                        <th>Input</th>
                        <th>Severity</th>
                        <th>CWE</th>
                    </tr>
                </thead>
                <% issues.each do |issue| %>
                <tr>
                    <td>
                        <%= link_to issue.name, "#description-#{issue.digest}",
                                    data: { toggle: 'collapse' } %>
                    </td>
                    <td class="url">
                        <div class="span4 td-url">
                            <%= link_to issue.url, issue.url %>
                        </div>
                    </td>
                    <td><%= issue.elem.capitalize %></td>
                    <td><%= issue.var %></td>
                    <td>
                        <p class="label label-<%= issue_severity_to_alert issue.severity %>">
                            <%= issue.severity %>
                        </p>
                    </td>
                    <td>
                        <% if issue.cwe_url %>
                            <%= link_to issue.cwe.to_s, issue.cwe_url %>
                        <% end %>
                    </td>
                </tr>
                <tr class="description">
                    <td class="description" colspan="7">

                        <div class="description-container collapse" id="description-<%= issue.digest %>">
                            <blockquote>
                                <%= issue.description %>
                            </blockquote>

                            <p>
                                See also:
                                <%= issue.references.map do |name, url|
                                    link_to name, url
                                end.join( ', ' ).html_safe %>
                            </p>
                        </div>
                    </td>
                </tr>
                <% end %>
            </table>

            <div class="visible-phone">
                <a href="#" onclick="$('.issue').collapse( 'show' ); return false;">Expand all</a>
                |
                <a href="#" onclick="$('.issue').collapse( 'hide' ); return false;">Collapse all</a>

                <hr/>

                <%= render partial: '/shared/issues_twin_accordion',
                           locals: {
                                   issues:     issues,
                                   class_name: 'span6'
                           }
                %>
            </div>
    <% else %>
            <p class="alert alert-info">
                No issues discovered<%= ' yet' if @scan.active? %>.
            </p>
        <% end %>

    </div>
</div>
